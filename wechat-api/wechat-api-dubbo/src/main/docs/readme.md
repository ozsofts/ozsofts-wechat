# 上行消息

* 所有上行消息(事件类型消息除外)和下行消息都会保存在数据表`t_mx_messages`中
* 现在系统仅对**用户关注**和**取消关注**两种事件进行了处理
* 对于某一个公众号来讲，支持关键字匹配的消息处理，在`t_mx_rules`中针对一个公众号，如果refType为空时，则表示是全局的关键字。关键字匹配的类型包括：
  * 按正则表达式进行匹配，这是系统最强大的匹配模式
  * 上行消息内容是以关键字开头
  * 上行消息内容是以关键字结尾
  * 上行消息内容包含关键字的内容
* 系统还支持针对一个互动活动的消息处理，现在包括：
  * 签到。如果上行消息内容为[__code 手机号码__]，其中code为`t_wx_rules`表中针对当前活动的编码。系统收到此信息后，会记录参与用户信息以及将手机号码记录在微信用户表中
  * 关键字消息回复。可以定制针对互动活动的关键字回复，此时需要将`t_wx_rules`表中设置`ref_type=‘ACTEVENT’`，并将活动的id设置到表中的`ref_id`字段中
  * 如果用户上行的即不是签到信息也不是关键字回复信息，则系统会将用户上行的消息记录在活动信息表`t_wx_actmessages`中
 